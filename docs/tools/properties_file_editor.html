<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>プロパティファイルエディター</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/autosize.js/6.0.1/autosize.min.js" integrity="sha512-OjjaC+tijryqhyPqy7jWSPCRj7fcosu1zreTX1k+OWSwu6uSqLLQ2kxaqL9UpR7xFaPsCwhMf1bQABw2rCxMbg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    tailwind.config = {
      // デフォルトのまま使うので何も書かない
    };
  </script>
  <style type="text/tailwindcss">
    label {
      @apply block text-center;
    }
    .textarea {
      @apply p-2 min-h-[32rem] w-full border border-slate-300;
    }
  </style>
</head>

<body class="bg-slate-200 p-4 pb-32">

  <div class="flex">
    <div class="flex-auto">
      <label>デコード済みテキスト</label>
      <textarea name="Input" id="Input" class="textarea" wrap="off"></textarea>
    </div>
    <div class="self-center">👈同期👉</div>
    <div class="flex-auto">
      <label>エンコード済みテキスト</label>
      <textarea name="Output" id="Output" class="textarea" wrap="off"></textarea>
    </div>
  </div>

  <script>
    (() => {
      'use strict';

      const escape = (str) => {
        const strs = str.split('');
        let result = '';
        for (let i = 0, len = strs.length; i < len; i++) {
          const hex = strs[i].charCodeAt(0).toString(16);
          result += '\\u' + ('0'.repeat(Math.abs(hex.length - 4))) + hex;
        }
        return result;
      };

      const unescape = (str) => {
        return str.replace(/\\u.{4}/ig, s => String.fromCharCode(s.replace('\\u', '0x')));
      };

      Input.addEventListener('keyup', (e) => {
        const val = Input.value
          .split(/\n/g)
          .map(row => {
            const [k, v] = row.split('=');
            return v === undefined ? row : `${k}=${escape(v)}`;
          })
          .join('\n');

        Output.value = val;
        autosize.update(Output);
      });

      Output.addEventListener('keyup', (e) => {
        const val = Output.value
          .split(/\n/g)
          .map(row => {
            const [k, v] = row.split('=');
            return v === undefined ? row : `${k}=${unescape(v)}`;
          })
          .join('\n');

        Input.value = val;
        autosize.update(Input);
      });

      autosize(Input);
      autosize(Output);
    })();
  </script>
</body>

</html>